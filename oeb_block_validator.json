{
  "$id": "https://openebench.bsc.es/vre/block-schema",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "OEB block definition schema",
  "description": "Specification of OEB blocks as required for VRE",
  "properties": {
    "_id": {
      "type": "string",
      "pattern": "^OpEB_block_[a-zA-Z0-9_]+[.]{1}[a-zA-Z0-9]+$"
    },
    "data": {
      "type": "object",
      "properties": {
        "owner": {
          "type": "object",
          "properties": {
            "institution": {
              "type": "string"
            },
            "author": {
              "type": "string"
            },
            "contact": {
              "type": "string"
            },
            "user": {
              "type": "string"
            },
            "oeb_community": {
              "type": "string"
            }
          },
          "required": [
            "institution",
            "author",
            "contact",
            "user"
          ]
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "workflow_manager": {
          "type": "string"
        },
        "publication_status": {
          "type": "integer",
          "enum": [
            0,
            1,
            2,
            3,
            4
          ]
        },
        "infrastructure": {
          "type": "object",
          "properties": {
            "executable": {
              "type": "string"
            },
            "cpus": {
              "type": "integer",
              "minimum": 1,
              "maximum": 12,
              "default": 1
            },
            "memory": {
              "type": "number",
              "minimum": 0,
              "maximum": 24,
              "default": 0
            },
            "wallTime": {
              "type": "integer",
              "minimum": 5,
              "maximum": 1440,
              "default": 1440
            },
            "clouds": {
              "type": "object",
              "properties": {
                "life-bsc": {
                  "$ref": "#/definitions/cloud"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "nextflow_files": {
          "type": "object",
          "properties": {
            "files": {
              "type": "object",
              "properties": {
                "life-bsc": {
                  "$ref": "#/definitions/cloud"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "type": {
          "type": "string",
          "enum": [
            "validation",
            "metrics",
            "consolidation"
          ]
        }
      },
      "required": [
        "owner",
        "name",
        "description",
        "workflow_manager",
        "publication_status",
        "infrastructure",
        "nextflow_files",
        "type"
      ],
      "additionalProperties": false
    },
    "validation_status": {
      "type": "integer",
      "enum": [
        0,
        1,
        2,
        3,
        4
      ]
    }
  },
  "required": [
    "_id",
    "data",
    "validation_status"
  ],
  "additionalProperties": false,
  "definitions": {
    "cloud": {
      "oneOf": [
        {
          "$ref": "#/definitions/SGE"
        },
        {
          "$ref": "#/definitions/PMES"
        }
      ]
    },
    "SGE": {
      "type": "object",
      "properties": {
        "launcher": {
          "type": "string",
          "pattern": "^SGE$"
        },
        "default_cloud": {
          "type": "boolean",
          "default": false
        },
        "queue": {
          "type": "string"
        }
      },
      "required": [
        "launcher",
        "queue"
      ],
      "additionalProperties": false
    },
    "PMES": {
      "type": "object",
      "properties": {
        "launcher": {
          "type": "string",
          "pattern": "^PMES$"
        },
        "workflowType": {
          "type": "string",
          "enum": [
            "Single",
            "COMPSs"
          ],
          "default": "Single"
        },
        "default_cloud": {
          "type": "boolean",
          "default": false
        },
        "minimumVMs": {
          "type": "integer",
          "default": 1
        },
        "initialVMs": {
          "type": "integer",
          "default": 1
        },
        "imageName": {
          "type": "string"
        }
      },
      "required": [
        "launcher",
        "workflowType",
        "minimumVMs",
        "initialVMs",
        "imageName"
      ],
      "additionalProperties": false
    }
  }
}
